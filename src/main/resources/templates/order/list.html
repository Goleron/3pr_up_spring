<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>–ó–∞–∫–∞–∑—ã</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div th:replace="~{fragments/navigation :: navbar}"></div>

<div class="container mt-4">
    <h2>üõí –ó–∞–∫–∞–∑—ã</h2>

    <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
    <div class="mb-3">
        <a th:href="@{/orders/new}" class="btn btn-success">‚ûï –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</a>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <form th:action="@{/orders}" method="get" class="row g-3 mb-3">
        <div class="col-md-3">
            <select name="userId" class="form-select">
                <option value="">‚Äî –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ‚Äî</option>
                <option th:each="u : ${users}" th:value="${u.id}"
                        th:text="${u.username}"
                        th:selected="${userId} == ${u.id}"></option>
            </select>
        </div>
        <div class="col-md-2">
            <select name="status" class="form-select">
                <option value="">‚Äî –í—Å–µ —Å—Ç–∞—Ç—É—Å—ã ‚Äî</option>
                <option value="PENDING" th:selected="${status} == 'PENDING'">–û–∂–∏–¥–∞–µ—Ç</option>
                <option value="PROCESSING" th:selected="${status} == 'PROCESSING'">–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</option>
                <option value="COMPLETED" th:selected="${status} == 'COMPLETED'">–í—ã–ø–æ–ª–Ω–µ–Ω</option>
                <option value="CANCELLED" th:selected="${status} == 'CANCELLED'">–û—Ç–º–µ–Ω—ë–Ω</option>
            </select>
        </div>
        <div class="col-md-2">
            <input type="date" name="dateFrom" th:value="${dateFrom}" class="form-control" placeholder="–û—Ç">
        </div>
        <div class="col-md-2">
            <input type="date" name="dateTo" th:value="${dateTo}" class="form-control" placeholder="–î–æ">
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100">üîç –§–∏–ª—å—Ç—Ä</button>
        </div>
    </form>

    <!-- –¢–∞–±–ª–∏—Ü–∞ -->
    <form id="deleteForm" th:action="@{/orders/delete}" method="post">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
            <tr>
                <th style="width: 50px;">
                    <input type="checkbox" id="selectAll" class="form-check-input">
                </th>
                <th>ID</th>
                <th>–î–∞—Ç–∞</th>
                <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–°—É–º–º–∞</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="o : ${orders}">
                <td>
                    <input type="checkbox" name="ids" th:value="${o.id}" class="form-check-input">
                </td>
                <td th:text="${o.id}"></td>
                <td th:text="${#temporals.format(o.orderDate, 'dd.MM.yyyy HH:mm')}"></td>
                <td th:text="${o.user.username}"></td>
                <td>
                    <span class="badge"
                          th:classappend="${o.status == 'COMPLETED'} ? 'bg-success' : (${o.status == 'CANCELLED'} ? 'bg-danger' : 'bg-warning')"
                          th:text="${o.status}"></span>
                </td>
                <td th:text="${o.totalAmount != null} ? ${o.totalAmount + ' ‚ÇΩ'} : '‚Äî'"></td>
                <td>
                    <a th:href="@{/orders/{id}(id=${o.id})}" class="btn btn-sm btn-info">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</a>
                </td>
            </tr>
            </tbody>
        </table>

        <div class="btn-group" role="group">
            <button type="submit" class="btn btn-warning" onclick="return confirm('–õ–æ–≥–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã?')">
                üóëÔ∏è –õ–æ–≥–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
            </button>
            <button type="button" class="btn btn-danger" onclick="hardDelete()">
                ‚ùå –§–∏–∑–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
            </button>
        </div>
    </form>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    <nav th:if="${totalPages > 1}" class="mt-4">
        <ul class="pagination">
            <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                <a class="page-link" th:href="@{/orders(page=${currentPage-1}, size=10, userId=${userId}, status=${status}, dateFrom=${dateFrom}, dateTo=${dateTo})}">¬´</a>
            </li>
            <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages-1)}"
                th:classappend="${i == currentPage} ? 'active'">
                <a class="page-link" th:href="@{/orders(page=${i}, size=10, userId=${userId}, status=${status}, dateFrom=${dateFrom}, dateTo=${dateTo})}"
                   th:text="${i+1}"></a>
            </li>
            <li class="page-item" th:classappend="${currentPage == totalPages-1} ? 'disabled'">
                <a class="page-link" th:href="@{/orders(page=${currentPage+1}, size=10, userId=${userId}, status=${status}, dateFrom=${dateFrom}, dateTo=${dateTo})}">¬ª</a>
            </li>
        </ul>
    </nav>
</div>

<script>
    document.getElementById('selectAll').onclick = function() {
        document.querySelectorAll('input[name="ids"]').forEach(cb => cb.checked = this.checked);
    };

    function hardDelete() {
        if (!confirm('–í–ù–ò–ú–ê–ù–ò–ï! –≠—Ç–æ –Ω–∞–≤—Å–µ–≥–¥–∞ —É–¥–∞–ª–∏—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
            return;
        }
        const form = document.getElementById('deleteForm');
        form.action = '/orders/hard-delete';
        form.submit();
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>