<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>–¢–æ–≤–∞—Ä—ã</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é -->
<div th:replace="~{fragments/navigation :: navbar}"></div>

<div class="container mt-4">
    <h2>üì¶ –¢–æ–≤–∞—Ä—ã</h2>

    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <form th:action="@{/products}" method="get" class="row g-3 mb-3">
        <div class="col-md-3">
            <input type="text" name="name" th:value="${name}" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" class="form-control">
        </div>
        <div class="col-md-3">
            <select name="categoryId" class="form-select">
                <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.name}"
                        th:selected="${categoryId} == ${cat.id}"></option>
            </select>
        </div>
        <div class="col-md-2">
            <input type="number" step="0.01" name="minPrice" th:value="${minPrice}" placeholder="–¶–µ–Ω–∞ –æ—Ç" class="form-control">
        </div>
        <div class="col-md-2">
            <input type="number" step="0.01" name="maxPrice" th:value="${maxPrice}" placeholder="–¶–µ–Ω–∞ –¥–æ" class="form-control">
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100">üîç –§–∏–ª—å—Ç—Ä</button>
        </div>
    </form>

    <!-- –¢–∞–±–ª–∏—Ü–∞ —Å —á–µ–∫–±–æ–∫—Å–∞–º–∏ -->
    <div class="mb-3">
        <a th:href="@{/products/new}" class="btn btn-success">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</a>
    </div>

    <form id="deleteForm" th:action="@{/products/delete}" method="post">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
            <tr>
                <th style="width: 50px;">
                    <input type="checkbox" id="selectAll" class="form-check-input">
                </th>
                <th>ID</th>
                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                <th>–¶–µ–Ω–∞</th>
                <th>–û—Å—Ç–∞—Ç–æ–∫</th>
                <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="p : ${products}">
                <td>
                    <input type="checkbox" name="ids" th:value="${p.id}" class="form-check-input">
                </td>
                <td th:text="${p.id}"></td>
                <td th:text="${p.name}"></td>
                <td th:text="${#strings.abbreviate(p.description, 50)} ?: '‚Äî'"></td>
                <td th:text="${p.price} + ' ‚ÇΩ'"></td>
                <td th:text="${p.stock}"></td>
                <td th:text="${p.category?.name} ?: '–ù–µ—Ç'"></td>
                <td>
                    <a th:href="@{/products/{id}/edit(id=${p.id})}" class="btn btn-sm btn-warning">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å</a>
                </td>
            </tr>
            </tbody>
        </table>

        <div class="btn-group" role="group">
            <button type="submit" class="btn btn-warning" onclick="return confirm('–õ–æ–≥–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã?')">
                üóëÔ∏è –õ–æ–≥–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
            </button>
            <button type="button" class="btn btn-danger" onclick="hardDelete()">
                ‚ùå –§–∏–∑–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
            </button>
        </div>
    </form>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    <nav th:if="${totalPages > 1}" class="mt-4">
        <ul class="pagination">
            <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                <a class="page-link" th:href="@{/products(page=${currentPage - 1}, size=10, name=${name}, categoryId=${categoryId}, minPrice=${minPrice}, maxPrice=${maxPrice})}">¬´</a>
            </li>
            <li th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                class="page-item"
                th:classappend="${i == currentPage} ? 'active'">
                <a class="page-link" th:href="@{/products(page=${i}, size=10, name=${name}, categoryId=${categoryId}, minPrice=${minPrice}, maxPrice=${maxPrice})}" th:text="${i + 1}"></a>
            </li>
            <li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
                <a class="page-link" th:href="@{/products(page=${currentPage + 1}, size=10, name=${name}, categoryId=${categoryId}, minPrice=${minPrice}, maxPrice=${maxPrice})}">¬ª</a>
            </li>
        </ul>
    </nav>
</div>

<script>
    // –í—ã–±—Ä–∞—Ç—å –≤—Å–µ —á–µ–∫–±–æ–∫—Å—ã
    document.getElementById('selectAll').onclick = function() {
        document.querySelectorAll('input[name="ids"]').forEach(cb => cb.checked = this.checked);
    };

    // –§–∏–∑–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
    function hardDelete() {
        if (!confirm('–í–ù–ò–ú–ê–ù–ò–ï! –≠—Ç–æ –Ω–∞–≤—Å–µ–≥–¥–∞ —É–¥–∞–ª–∏—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –ë–î. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
            return;
        }
        const form = document.getElementById('deleteForm');
        form.action = '/products/hard-delete';
        form.submit();
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>